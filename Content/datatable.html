<!DOCTYPE html>
<html>
	<head>
		<title>DataTables example - Search API (regular expressions)</title>>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-2.2.4/dt-1.10.15/datatables.min.css" />
    <script langauge="JavaScript" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-2.2.4/dt-1.10.15/datatables.min.js"></script>
		<script language="JavaScript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/json2/20160511/json2.js"></script>
		<script type="text/javascript" class="init">

		$.fn.dataTable.ext.search.push(
			function( settings, data, dataIndex ) {
				var min = parseInt( $('#min').val(), 10 );
				var max = parseInt( $('#max').val(), 10 );
				var nopVOG = parseFloat( data[4] ) || 0; // use data for the age column

				if (( isNaN( min ) && isNaN( max )) ||
					 ( isNaN( min ) && nopVOG <= max ) ||
					 ( min <= nopVOG   && isNaN( max )) ||
					 ( min <= nopVOG   && nopVOG <= max ))
				{
					return true;
				}
				return false;
			}
		);

		function filterGlobal () {
			$('#example').DataTable().search(
				$('#global_filter').val(),
				$('#global_regex').prop('checked'),
				$('#global_smart').prop('checked')
			).draw();
		}

		function filterColumn ( i ) {
			$('#example').DataTable().column( i ).search(
				$('#col'+i+'_filter').val(),
				$('#col'+i+'_regex').prop('checked'),
				$('#col'+i+'_smart').prop('checked')
			).draw();
		}

		$(document).ready(function() {

			$('#searchLink').click(function(){
				$('#searchTable').toggle('slow');
			} );

			$('#rangeLink').click(function(){
				$('#rangeSearch').toggle('slow');
			} );

			var table = $('#example').DataTable({
				"ajax" : 'http://localhost:8000/helper/JSONSample.txt',
				initComplete: function () {
					this.api().columns([6,7]).every( function () {
						var column = this;
						var select = $('<select><option value=""></option></select>')
							.appendTo( $(column.header()).empty() )
							.on( 'change', function () {
								var val = $.fn.dataTable.util.escapeRegex(
									$(this).val()
								);

								column
									.search( val ? '^'+val+'$' : '', true, false )
									.draw();
							} );

						column.data().unique().sort().each( function ( d, j ) {
							select.append( '<option value="'+d+'">'+d+'</option>' )
						} );
					} );
				}
			});

			$('#min, #max').keyup( function() {
				table.draw();
			} );

			$('input.global_filter').on( 'keyup click', function () {
				filterGlobal();
			} );

			$('input.column_filter').on( 'keyup click', function () {
				filterColumn( $(this).parents('tr').attr('data-column') );
			} );
		} );


		</script>
	</head>
	<body>
		<button id="rangeLink" onclick="toggleRange();">Range Search</button>
		<table id="rangeSearch">
			<tbody>
				<tr>
					<td>Minimum # of pVOGs:</td>
					<td><input type="text" id="min" name="min"></td>
				</tr>
				<tr>
					<td>Maximum # of pVOGs:</td>
					<td><input type="text" id="max" name="max"></td>
				</tr>
			</tbody>
		</table>

		<button id="searchLink" onclick="toggleTable();">Search Columns</button>
		<table id="searchTable">
		<thead>
			<tr>
				<th>Target</th>
				<th>Search text</th>
				<th>Treat as regex</th>
				<th>Use smart search</th>
			</tr>
		</thead>
		<tbody>
			<tr id="filter_global">
				<td>Global search</td>
				<td align="center"><input type="text" class="global_filter" id="global_filter"></td>
				<td align="center"><input type="checkbox" class="global_filter" id="global_regex"></td>
				<td align="center"><input type="checkbox" class="global_filter" id="global_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col1" data-column="0">
				<td>Organism Name</td>
				<td align="center"><input type="text" class="column_filter" id="col0_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col0_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col0_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col2" data-column="1">
				<td>Genome Accession</td>
				<td align="center"><input type="text" class="column_filter" id="col1_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col1_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col1_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col3" data-column="2">
				<td>Genome Size</td>
				<td align="center"><input type="text" class="column_filter" id="col2_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col2_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col2_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col4" data-column="3">
				<td>Proteins</td>
				<td align="center"><input type="text" class="column_filter" id="col3_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col3_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col3_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col5" data-column="4">
				<td># Vogs</td>
				<td align="center"><input type="text" class="column_filter" id="col4_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col4_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col4_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col6" data-column="5">
				<td>Host</td>
				<td align="center"><input type="text" class="column_filter" id="col5_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col5_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col5_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col8" data-column="7">
				<td>Genetic Material</td>
				<td align="center"><input type="text" class="column_filter" id="col7_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col7_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col7_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col9" data-column="8">
				<td>Order</td>
				<td align="center"><input type="text" class="column_filter" id="col8_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col8_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col9_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col10" data-column="9">
				<td>Family</td>
				<td align="center"><input type="text" class="column_filter" id="col9_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col9_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col9_smart" checked="checked"></td>
			</tr>
			<tr id="filter_col11" data-column="10">
				<td>Genus</td>
				<td align="center"><input type="text" class="column_filter" id="col10_filter"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col10_regex"></td>
				<td align="center"><input type="checkbox" class="column_filter" id="col10_smart" checked="checked"></td>
			</tr>
		</tbody>
		</table>
		<table id="example" class="display" style="width: 100%;">
			<thead>
	        <tr>
	          <th>Organism Name</th>
	          <th>Genome Accession</th>
	          <th>Genome Size (bp)</th>
	          <th>Proteins</th>
	          <th># of VOGs</th>
	          <th>Host</th>
	          <th>Host Domain</th>
	          <th>Genetic Material</th>
	          <th>Order</th>
	          <th>Family</th>
	          <th>Genus</th>
	        </tr>
	      </thead>
	      <tfoot>
	        <tr>
	          <th>Organism Name</th>
	          <th>Genome Accession</th>
	          <th>Genome Size (bp)</th>
	          <th>Proteins</th>
	          <th># of VOGs</th>
	          <th>Host</th>
	          <th>Host Domain</th>
	          <th>Genetic Material</th>
	          <th>Order</th>
	          <th>Family</th>
	          <th>Genus</th>
	        </tr>
	      </tfoot>
		</table>
	</body>
</html>
